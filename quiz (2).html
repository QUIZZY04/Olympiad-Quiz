<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Quiz â€” OlympiadPortal</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css">
<meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

<style>
/* â”€â”€â”€ TOKENS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
:root{
  --ink:       #0c0e14;
  --ink-light: #1a1f2e;
  --canvas:    #f5f4f0;
  --white:     #ffffff;
  --gold:      #c8922a;
  --gold-lt:   #e6b04a;
  --gold-dim:  rgba(200,146,42,0.12);
  --gold-line: rgba(200,146,42,0.35);
  --mist:      #8a909e;
  --border:    rgba(12,14,20,0.09);
  --shadow-sm: 0 2px 12px rgba(12,14,20,0.08);
  --shadow-md: 0 8px 32px rgba(12,14,20,0.12);
  --shadow-lg: 0 20px 60px rgba(12,14,20,0.18);
  --correct:   #1a7f5a;
  --wrong:     #c0392b;
  --ff-serif: 'Playfair Display', Georgia, serif;
  --ff-sans:  'Plus Jakarta Sans', system-ui, sans-serif;
  --nav-h: 62px;
  --bar-h: 52px;
  --r: 14px;
}

*,*::before,*::after{ margin:0; padding:0; box-sizing:border-box; }
html{ font-size:16px; }

body{
  font-family: var(--ff-sans);
  background: var(--canvas);
  color: var(--ink);
  min-height: 100vh;
  overflow: hidden;
}

/* subtle linen texture overlay */
body::after{
  content:'';
  position:fixed; inset:0;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='300'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3C/filter%3E%3Crect width='300' height='300' filter='url(%23n)' opacity='0.025'/%3E%3C/svg%3E");
  pointer-events:none; z-index:0;
}

/* â”€â”€â”€ NAVBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.top-nav{
  position:fixed; top:0; left:0; right:0;
  height: var(--nav-h);
  background: var(--ink);
  display:flex; align-items:center; justify-content:space-between;
  padding: 0 36px;
  z-index: 9999;
}

.nav-brand{
  display:flex; align-items:center; gap:10px;
  font-family: var(--ff-serif);
  font-size:19px; font-weight:700;
  color: var(--gold-lt);
  letter-spacing:0.3px;
}

.nav-brand-icon{
  width:30px; height:30px;
  border:1.5px solid var(--gold);
  border-radius:6px;
  display:flex; align-items:center; justify-content:center;
  font-size:14px;
}

.nav-links{
  display:flex; align-items:center; gap:4px;
}

.nav-links a{
  font-size:13px; font-weight:500;
  color: rgba(255,255,255,0.5);
  text-decoration:none;
  padding:7px 13px;
  border-radius:8px;
  display:flex; align-items:center; gap:6px;
  transition: color .2s, background .2s;
}
.nav-links a:hover{ color:#fff; background:rgba(255,255,255,0.08); }

.nav-links svg{ width:14px; height:14px; flex-shrink:0; }

.nav-sep{ width:1px; height:20px; background:rgba(255,255,255,0.1); margin:0 6px; }

.nav-logout{
  font-size:13px; font-weight:600;
  color: #f87171;
  background:rgba(248,113,113,0.1);
  border:1px solid rgba(248,113,113,0.2);
  padding:7px 14px; border-radius:8px;
  display:flex; align-items:center; gap:6px;
  cursor:pointer; transition: all .2s;
}
.nav-logout:hover{ background:rgba(248,113,113,0.2); color:#fca5a5; }
.nav-logout svg{ width:14px; height:14px; }

/* â”€â”€â”€ SUBHEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.subheader{
  position:fixed;
  top: var(--nav-h); left:0; right:0;
  height: var(--bar-h);
  background: var(--white);
  border-bottom: 1px solid var(--border);
  display:flex; align-items:center; justify-content:space-between;
  padding: 0 36px;
  z-index:998;
  box-shadow: var(--shadow-sm);
}

.subject-tag{
  display:flex; align-items:center; gap:10px;
}

.subject-badge{
  background: var(--gold-dim);
  border: 1px solid var(--gold-line);
  color: var(--gold);
  font-size:11px; font-weight:700;
  letter-spacing:1.5px; text-transform:uppercase;
  padding:4px 10px; border-radius:6px;
}

.subject-name{
  font-family: var(--ff-sans);
  font-size:13.5px; font-weight:600;
  color: var(--ink);
  letter-spacing:0.2px;
}

/* timer */
.timer-block{
  display:flex; align-items:center; gap:14px;
}

.timer-ring-wrap{
  position:relative; width:36px; height:36px;
}

.timer-ring-wrap svg{
  transform:rotate(-90deg);
}

.timer-ring-bg{ fill:none; stroke:#e8e6e1; stroke-width:3; }
.timer-ring-fill{
  fill:none; stroke: var(--gold); stroke-width:3;
  stroke-linecap:round;
  stroke-dasharray:100;
  stroke-dashoffset:0;
  transition: stroke-dashoffset 1s linear, stroke .3s;
}

.timer-val{
  font-family: var(--ff-serif);
  font-size:22px; font-weight:700;
  color: var(--ink);
  letter-spacing:1px;
  min-width:72px;
  transition: color .3s;
}

.timer-val.danger{ color: var(--wrong); animation: pulse-txt 1s ease-in-out infinite; }
@keyframes pulse-txt{ 0%,100%{opacity:1} 50%{opacity:.5} }

/* â”€â”€â”€ MAIN LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.quiz-wrap{
  display:flex;
  height: calc(100vh - var(--nav-h) - var(--bar-h));
  margin-top: calc(var(--nav-h) + var(--bar-h));
  position:relative; z-index:1;
}

/* â”€â”€â”€ LEFT PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.q-panel{
  flex:1;
  padding: 40px 52px;
  overflow-y:auto;
  scrollbar-width:thin; scrollbar-color:#d4cfc7 transparent;
}
.q-panel::-webkit-scrollbar{ width:4px; }
.q-panel::-webkit-scrollbar-thumb{ background:#d4cfc7; border-radius:4px; }

/* progress */
.prog-row{
  display:flex; align-items:center; gap:14px;
  margin-bottom:32px;
}

.prog-bar-wrap{
  flex:1; height:4px;
  background:#e4e0d9; border-radius:99px; overflow:hidden;
}

.prog-bar-fill{
  height:100%; width:0%;
  background: linear-gradient(90deg, var(--gold), var(--gold-lt));
  border-radius:99px;
  transition: width .5s cubic-bezier(.4,0,.2,1);
}

.prog-label{
  font-size:12px; font-weight:600; color: var(--mist);
  white-space:nowrap;
}

.prog-pct{
  font-family: var(--ff-serif);
  font-size:14px; font-weight:700; color: var(--gold);
  min-width:36px; text-align:right;
}

/* question card */
.q-card{
  background: var(--white);
  border-radius:20px;
  border:1px solid var(--border);
  box-shadow: var(--shadow-md);
  padding:44px 48px;
  position:relative; overflow:hidden;
  animation: qslide .4s cubic-bezier(.4,0,.2,1) both;
}

@keyframes qslide{
  from{ opacity:0; transform:translateY(16px); }
  to  { opacity:1; transform:translateY(0); }
}

/* giant decorative Q number */
.q-watermark{
  position:absolute;
  top:-10px; right:30px;
  font-family: var(--ff-serif);
  font-size:140px; font-weight:900;
  color: rgba(12,14,20,0.04);
  line-height:1;
  pointer-events:none; user-select:none;
  letter-spacing:-6px;
}

.q-meta{
  display:flex; align-items:center; gap:12px;
  margin-bottom:22px;
}

.q-chip{
  font-size:10.5px; font-weight:700; letter-spacing:2px;
  text-transform:uppercase; color: var(--gold);
  background: var(--gold-dim);
  border: 1px solid var(--gold-line);
  padding:4px 10px; border-radius:6px;
}

.q-count{
  font-size:13px; font-weight:500; color: var(--mist);
}

.q-text{
  font-family: var(--ff-serif);
  font-size:21px; font-weight:700;
  color: var(--ink);
  line-height:1.6;
  margin-bottom:32px;
  position:relative; z-index:1;
}

/* options */
.options{ display:flex; flex-direction:column; gap:10px; }

.opt-label{
  display:flex; align-items:center; gap:14px;
  padding:15px 20px;
  border:1.5px solid #e8e4de;
  border-radius:12px;
  cursor:pointer;
  font-size:15px; font-weight:500;
  color:#3a3f4e;
  background: #fdfcfb;
  position:relative; overflow:hidden;
  transition: border-color .2s, background .2s, transform .15s, box-shadow .2s;
  user-select:none;
}

.opt-label::before{
  content:'';
  position:absolute; left:0; top:0; bottom:0;
  width:0;
  background: linear-gradient(90deg, var(--gold-dim), transparent);
  transition: width .25s ease;
}

.opt-label:hover{
  border-color: var(--gold-lt);
  background:#fffaf2;
  transform: translateX(4px);
  box-shadow: var(--shadow-sm);
}
.opt-label:hover::before{ width:100%; }

.opt-label.selected{
  border-color: var(--gold);
  background:#fffaf0;
  box-shadow: 0 0 0 3px var(--gold-dim), var(--shadow-sm);
  transform: translateX(4px);
}
.opt-label.selected::before{ width:100%; }

.opt-input{ display:none; }

.opt-key{
  min-width:32px; height:32px;
  border-radius:8px;
  border: 1.5px solid #ddd8d0;
  display:flex; align-items:center; justify-content:center;
  font-family: var(--ff-serif);
  font-size:13px; font-weight:700;
  color:#aaa5a0;
  flex-shrink:0;
  transition: all .2s;
  background:#fff;
}

.opt-label:hover .opt-key{
  border-color: var(--gold);
  color: var(--gold);
}

.opt-label.selected .opt-key{
  background: var(--gold);
  border-color: var(--gold);
  color:#fff;
}

/* nav buttons */
.q-actions{
  display:flex; align-items:center; gap:10px;
  margin-top:30px;
}

.btn{
  display:inline-flex; align-items:center; gap:7px;
  padding:11px 22px; border-radius:10px;
  font-family: var(--ff-sans);
  font-size:14px; font-weight:600;
  cursor:pointer; border:none;
  transition: all .2s;
  letter-spacing:0.1px;
}

.btn svg{ width:15px; height:15px; }

.btn-outline{
  background: var(--white);
  color: var(--ink-light);
  border: 1.5px solid var(--border);
  box-shadow: var(--shadow-sm);
}
.btn-outline:hover{
  background:#f0ede7;
  border-color:#ccc7be;
  transform:translateY(-1px);
}

.btn-gold{
  background: var(--gold);
  color:#fff;
  box-shadow: 0 4px 16px rgba(200,146,42,0.35);
  margin-left:auto;
}
.btn-gold:hover{
  background: var(--gold-lt);
  transform:translateY(-2px);
  box-shadow: 0 8px 28px rgba(200,146,42,0.45);
}

/* â”€â”€â”€ SIDEBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.sidebar{
  width:270px; flex-shrink:0;
  background: var(--white);
  border-left:1px solid var(--border);
  padding:28px 20px;
  overflow-y:auto;
  display:flex; flex-direction:column; gap:22px;
  scrollbar-width:thin; scrollbar-color:#d4cfc7 transparent;
}

.sidebar::-webkit-scrollbar{ width:3px; }
.sidebar::-webkit-scrollbar-thumb{ background:#d4cfc7; border-radius:3px; }

.sb-label{
  font-size:10px; font-weight:700;
  letter-spacing:2.5px; text-transform:uppercase;
  color:#b0a89e;
}

/* stat cards */
.stat-grid{ display:grid; grid-template-columns:1fr 1fr; gap:8px; }

.stat-card{
  background: #faf9f7;
  border: 1px solid var(--border);
  border-radius:12px;
  padding:14px 16px;
  display:flex; flex-direction:column; gap:4px;
}

.stat-card-val{
  font-family: var(--ff-serif);
  font-size:26px; font-weight:900;
  line-height:1;
}

.stat-card-lbl{
  font-size:11px; font-weight:600;
  letter-spacing:.5px; text-transform:uppercase;
  color: var(--mist);
}

.sc-ans .stat-card-val { color: #1a7f5a; }
.sc-skip .stat-card-val{ color: #c0392b; }
.sc-rem .stat-card-val { color: var(--gold); }
.sc-cur .stat-card-val { color: var(--ink); }

/* legend */
.legend{ display:flex; flex-direction:column; gap:7px; }

.leg-row{
  display:flex; align-items:center; gap:9px;
  font-size:12.5px; font-weight:500;
  color:#6b6860;
}

.leg-swatch{
  width:22px; height:22px; border-radius:6px;
  flex-shrink:0;
}

/* grid palette */
.palette-grid{
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:6px;
}

.pal-cell{
  aspect-ratio:1;
  border-radius:8px;
  display:flex; align-items:center; justify-content:center;
  font-family: var(--ff-serif);
  font-size:12px; font-weight:700;
  cursor:pointer;
  background:#f0ede7;
  color:#a09a92;
  border:1.5px solid transparent;
  transition: transform .15s, box-shadow .15s;
}
.pal-cell:hover{ transform:scale(1.2); box-shadow: var(--shadow-sm); z-index:2; }

/* â”€â”€â”€ MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.modal-overlay{
  display:none; position:fixed; inset:0;
  background:rgba(12,14,20,0.55);
  backdrop-filter:blur(6px);
  z-index:99999;
  align-items:center; justify-content:center;
}
.modal-overlay.show{ display:flex; }

.modal{
  background: var(--white);
  border-radius:22px;
  border:1px solid var(--border);
  box-shadow: var(--shadow-lg);
  padding:44px 40px;
  max-width:420px; width:90%;
  text-align:center;
  animation: mpop .35s cubic-bezier(.34,1.56,.64,1) both;
}

@keyframes mpop{
  from{ opacity:0; transform:scale(.85) translateY(24px); }
  to  { opacity:1; transform:scale(1) translateY(0); }
}

.modal-emoji{ font-size:42px; margin-bottom:14px; display:block; }

.modal h3{
  font-family: var(--ff-serif);
  font-size:24px; font-weight:700;
  color: var(--ink);
  margin-bottom:10px;
}

.modal p{
  font-size:14.5px; color: var(--mist);
  line-height:1.65; margin-bottom:28px;
}

.modal-btns{ display:flex; gap:12px; }

.modal-btns button{
  flex:1; padding:13px 18px;
  border-radius:11px; border:none;
  font-family: var(--ff-sans);
  font-size:14px; font-weight:600;
  cursor:pointer; transition:all .2s;
}

.m-stay{
  background:#f0ede7;
  color: var(--ink);
  border:1px solid var(--border);
}
.m-stay:hover{ background:#e5e0d8; }

.m-leave{
  background: #c0392b;
  color:#fff;
  box-shadow:0 4px 14px rgba(192,57,43,0.3);
}
.m-leave:hover{ background:#e74c3c; transform:translateY(-1px); }
</style>
</head>
<body>

<!-- â•â•â• NAVBAR â•â•â• -->
<nav class="top-nav">
  <div class="nav-brand">
    <div class="nav-brand-icon">ğŸ†</div>
    OlympiadPortal
  </div>
  <div class="nav-links">
    <a href="index.html">
      <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l9-9 9 9M4 10v10h5v-6h6v6h5V10"/>
      </svg>
      Home
    </a>
    <a href="dashboard.html">
      <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4 5a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1H5a1 1 0 01-1-1V5zm10 0a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1V5zM4 15a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1H5a1 1 0 01-1-1v-4zm10 0a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z"/>
      </svg>
      Dashboard
    </a>
    <a href="leaderboard.html">
      <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
      </svg>
      Leaderboard
    </a>
    <div class="nav-sep"></div>
    <button class="nav-logout" onclick="handleLogout()">
      <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a2 2 0 01-2 2H6a2 2 0 01-2-2V7a2 2 0 012-2h5a2 2 0 012 2v1"/>
      </svg>
      Logout
    </button>
  </div>
</nav>

<!-- â•â•â• SUBHEADER â•â•â• -->
<div class="subheader">
  <div class="subject-tag">
    <div class="subject-badge">Live Quiz</div>
    <div class="subject-name" id="subjectTitle">Loading...</div>
  </div>
  <div class="timer-block">
    <div class="timer-ring-wrap">
      <svg width="36" height="36" viewBox="0 0 36 36">
        <circle class="timer-ring-bg" cx="18" cy="18" r="15"/>
        <circle class="timer-ring-fill" id="timerRing" cx="18" cy="18" r="15"
          style="stroke-dasharray: 94.25; stroke-dashoffset: 0;"/>
      </svg>
    </div>
    <div class="timer-val" id="timer">30:00</div>
  </div>
</div>

<!-- â•â•â• BODY â•â•â• -->
<div class="quiz-wrap">

  <!-- QUESTION PANEL -->
  <div class="q-panel">

    <div class="prog-row">
      <div class="prog-label">Progress</div>
      <div class="prog-bar-wrap">
        <div class="prog-bar-fill" id="progressFill"></div>
      </div>
      <div class="prog-pct" id="progressPct">0%</div>
    </div>

    <div class="q-card" id="qCard">
      <div class="q-watermark" id="qWatermark">01</div>

      <div class="q-meta">
        <div class="q-chip" id="questionNumber">Question 1</div>
        <div class="q-count" id="qCountLabel">of 30</div>
      </div>

      <div class="q-text" id="questionText">Loading question...</div>

      <div class="options" id="options"></div>
    </div>

    <div class="q-actions">
      <button class="btn btn-outline" onclick="prevQuestion()">
        <svg fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/>
        </svg>
        Previous
      </button>
      <button class="btn btn-outline" onclick="nextQuestion()">
        Next
        <svg fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/>
        </svg>
      </button>
      <button class="btn btn-gold" onclick="confirmSubmit()">
        <svg fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        Submit Quiz
      </button>
    </div>

  </div>

  <!-- SIDEBAR -->
  <div class="sidebar">

    <div>
      <div class="sb-label" style="margin-bottom:12px;">Your Stats</div>
      <div class="stat-grid">
        <div class="stat-card sc-ans">
          <div class="stat-card-val" id="statAnswered">0</div>
          <div class="stat-card-lbl">Answered</div>
        </div>
        <div class="stat-card sc-skip">
          <div class="stat-card-val" id="statSkipped">0</div>
          <div class="stat-card-lbl">Skipped</div>
        </div>
        <div class="stat-card sc-rem">
          <div class="stat-card-val" id="statRemaining">0</div>
          <div class="stat-card-lbl">Remaining</div>
        </div>
        <div class="stat-card sc-cur">
          <div class="stat-card-val" id="statCurrent">1</div>
          <div class="stat-card-lbl">Current Q</div>
        </div>
      </div>
    </div>

    <div>
      <div class="sb-label" style="margin-bottom:12px;">Legend</div>
      <div class="legend">
        <div class="leg-row">
          <div class="leg-swatch" style="background:#c8922a;"></div>
          Active question
        </div>
        <div class="leg-row">
          <div class="leg-swatch" style="background:#d1fae5; border:1.5px solid #6ee7b7;"></div>
          Answered
        </div>
        <div class="leg-row">
          <div class="leg-swatch" style="background:#fee2e2; border:1.5px solid #fca5a5;"></div>
          Visited, skipped
        </div>
        <div class="leg-row">
          <div class="leg-swatch" style="background:#f0ede7; border:1.5px solid transparent;"></div>
          Not visited
        </div>
      </div>
    </div>

    <div>
      <div class="sb-label" style="margin-bottom:12px;">Jump to Question</div>
      <div class="palette-grid" id="questionGrid"></div>
    </div>

  </div>

</div>

<!-- â•â•â• MODAL â•â•â• -->
<div class="modal-overlay" id="exitModal">
  <div class="modal">
    <span class="modal-emoji" id="modalEmoji">âš ï¸</span>
    <h3 id="modalTitle">Leave Quiz?</h3>
    <p id="modalDesc">Your progress will be lost if you navigate away. Are you sure?</p>
    <div class="modal-btns">
      <button class="m-stay" onclick="closeModal()">Stay in Quiz</button>
      <button class="m-leave" id="modalLeaveBtn">Leave</button>
    </div>
  </div>
</div>

<script src="questions.js"></script>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, query, where, getDocs }
  from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyB49W61ggHHJcAJ5WyYTmX13I8NofsggSY",
  authDomain: "olympiad-portal-d2a5e.firebaseapp.com",
  projectId: "olympiad-portal-d2a5e",
  storageBucket: "olympiad-portal-d2a5e.firebasestorage.app",
  messagingSenderId: "341855557503",
  appId: "1:341855557503:web:5cb0c3a9ee424a6db0ec4a"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db   = getFirestore(app);

let current = 0, score = 0, questions = [];
let selectedAnswers = [], visitedQuestions = [];
let pendingNavUrl = null;
let totalTime = 1800;

const selectedClass   = localStorage.getItem("selectedClass")   || "class4";
const selectedSubject = localStorage.getItem("selectedSubject") || "maths";

document.getElementById("subjectTitle").innerText =
  selectedClass.replace("class","Class ") + " â€” " + selectedSubject.charAt(0).toUpperCase() + selectedSubject.slice(1);

/* â”€â”€ Nav intercept â”€â”€ */
document.querySelectorAll(".nav-links a").forEach(link => {
  link.addEventListener("click", e => {
    e.preventDefault();
    pendingNavUrl = link.href;
    openModal("âš ï¸","Leave Quiz?","Your quiz progress will be lost. Are you sure you want to leave?","Leave",() => {
      window.location.href = pendingNavUrl;
    });
  });
});

window.handleLogout = () =>
  openModal("ğŸ‘‹","Logout?","Your quiz progress will be lost on logout. Continue?","Logout", async () => {
    await signOut(auth);
    window.location.href = "login.html";
  });

function openModal(emoji, title, desc, btnTxt, action){
  document.getElementById("modalEmoji").innerText = emoji;
  document.getElementById("modalTitle").innerText = title;
  document.getElementById("modalDesc").innerText  = desc;
  const btn = document.getElementById("modalLeaveBtn");
  btn.innerText = btnTxt;
  btn.onclick   = action;
  document.getElementById("exitModal").classList.add("show");
}

window.closeModal = () => {
  document.getElementById("exitModal").classList.remove("show");
  pendingNavUrl = null;
};

/* â”€â”€ Load Questions â”€â”€ */
async function loadQuestionsHybrid(){
  try{
    const q = query(collection(db,"questions"),
      where("class","==",selectedClass),
      where("subject","==",selectedSubject));
    const snap = await getDocs(q);
    if(!snap.empty){
      let all = snap.docs.map(d=>d.data());
      all.sort(()=>Math.random()-.5);
      questions = all.slice(0,30);
    } else {
      questions = questionsData[selectedClass][selectedSubject];
      questions.sort(()=>Math.random()-.5);
    }
  } catch {
    questions = questionsData[selectedClass][selectedSubject];
    questions.sort(()=>Math.random()-.5);
  }
  selectedAnswers  = new Array(questions.length).fill(null);
  visitedQuestions = new Array(questions.length).fill(false);
  buildGrid();
  renderQuestion();
  updateStats();
}

onAuthStateChanged(auth, async user => {
  if(!user){ window.location.replace("login.html"); return; }
  await loadQuestionsHybrid();
});

/* â”€â”€ Timer â”€â”€ */
const timerEl   = document.getElementById("timer");
const timerRing = document.getElementById("timerRing");
const CIRC = 94.25;

const timerInterval = setInterval(()=>{
  const m = Math.floor(totalTime/60);
  const s = totalTime % 60;
  timerEl.innerText = m + ":" + (s<10?"0":"") + s;
  const pct = totalTime / 1800;
  timerRing.style.strokeDashoffset = CIRC * (1 - pct);
  if(totalTime <= 300){ timerRing.style.stroke = "#c0392b"; }
  if(totalTime <= 60) { timerEl.classList.add("danger"); }
  totalTime--;
  if(totalTime < 0){ clearInterval(timerInterval); submitQuiz(); }
},1000);

/* â”€â”€ Quiz Logic â”€â”€ */
const OPT_KEYS = ["A","B","C","D","E"];

function renderQuestion(){
  visitedQuestions[current] = true;
  const q = questions[current];

  // watermark
  document.getElementById("qWatermark").innerText =
    String(current+1).padStart(2,"0");

  document.getElementById("questionNumber").innerText = "Question " + (current+1);
  document.getElementById("qCountLabel").innerText    = "of " + questions.length;
  document.getElementById("questionText").innerHTML   = q.q;

  // restart animation
  const card = document.getElementById("qCard");
  card.style.animation="none"; void card.offsetHeight;
  card.style.animation="qslide .4s cubic-bezier(.4,0,.2,1) both";

  // options
  let html = "";
  q.o.forEach((opt,i)=>{
    const sel = selectedAnswers[current]===i ? " selected":"";
    html += `
      <label class="opt-label${sel}" onclick="pickOption(${i},this)">
        <input class="opt-input" type="radio" name="opt" value="${i}"
          ${selectedAnswers[current]===i?"checked":""}>
        <div class="opt-key">${OPT_KEYS[i]||i+1}</div>
        <span>${opt}</span>
      </label>`;
  });
  document.getElementById("options").innerHTML = html;

  updateGrid();
  updateStats();
}

window.pickOption = function(v, labelEl){
  selectedAnswers[current] = v;
  document.querySelectorAll(".opt-label").forEach(l=>l.classList.remove("selected"));
  labelEl.classList.add("selected");
  updateStats();
  updateGrid();
};

window.nextQuestion = () => { if(current<questions.length-1){ current++; renderQuestion(); } };
window.prevQuestion = () => { if(current>0)              { current--; renderQuestion(); } };

window.confirmSubmit = () => {
  const unanswered = selectedAnswers.filter(a=>a===null).length;
  openModal(
    unanswered>0?"âš ï¸":"âœ…",
    "Submit Quiz?",
    unanswered>0
      ? `You have ${unanswered} unanswered question${unanswered>1?"s":""}. Submit anyway?`
      : "You've answered all questions. Ready to submit?",
    "Submit Quiz",
    submitQuiz
  );
};

function submitQuiz(){
  clearInterval(timerInterval);
  score = questions.reduce((acc,q,i)=> acc + (selectedAnswers[i]===q.a?1:0), 0);
  localStorage.setItem("quizResult", JSON.stringify({
    score, total:questions.length,
    subject:selectedSubject, class:selectedClass,
    answers:selectedAnswers, questions,
    date:new Date().toLocaleString()
  }));
  window.location.href = "result.html";
}

function buildGrid(){
  let html="";
  for(let i=0;i<questions.length;i++)
    html += `<div class="pal-cell" onclick="jumpTo(${i})" id="pc${i}">${i+1}</div>`;
  document.getElementById("questionGrid").innerHTML = html;
}

window.jumpTo = i => { current=i; renderQuestion(); };

function updateStats(){
  const answered  = selectedAnswers.filter(a=>a!==null).length;
  const skipped   = visitedQuestions.filter((v,i)=>v && selectedAnswers[i]===null).length;
  const remaining = questions.length - answered;
  const pct       = questions.length ? Math.round(answered/questions.length*100) : 0;

  document.getElementById("statAnswered").innerText  = answered;
  document.getElementById("statSkipped").innerText   = skipped;
  document.getElementById("statRemaining").innerText = remaining;
  document.getElementById("statCurrent").innerText   = current+1;
  document.getElementById("progressFill").style.width = pct+"%";
  document.getElementById("progressPct").innerText   = pct+"%";
}

function updateGrid(){
  for(let i=0;i<questions.length;i++){
    const c = document.getElementById("pc"+i);
    if(!c) continue;
    if(i===current){
      c.style.cssText = "background:#c8922a; color:#fff; border-color:#c8922a; box-shadow:0 0 0 2px rgba(200,146,42,0.3);";
    } else if(selectedAnswers[i]!==null){
      c.style.cssText = "background:#d1fae5; color:#065f46; border-color:#6ee7b7; box-shadow:none;";
    } else if(visitedQuestions[i]){
      c.style.cssText = "background:#fee2e2; color:#991b1b; border-color:#fca5a5; box-shadow:none;";
    } else {
      c.style.cssText = "background:#f0ede7; color:#a09a92; border-color:transparent; box-shadow:none;";
    }
  }
}
</script>
</body>
</html>
