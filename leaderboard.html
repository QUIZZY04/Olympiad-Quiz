/* ===== LOAD LEADERBOARD ===== */
async function loadLeaderboard() {
    const leaderboardBody = document.getElementById("leaderboardBody");
    leaderboardBody.innerHTML = "";

    try {
        // Query leaderboard collection, sorted by score (highest first)
        const q = query(
            collection(db, "leaderboard"),
            orderBy("score", "desc")
        );
        const querySnapshot = await getDocs(q);

        let rank = 1;

        querySnapshot.forEach((doc) => {
            const data = doc.data();
            console.log("Fetched doc:", data); // Debugging log

            // Assign row class for top 3 ranks
            let rowClass = "";
            if (rank === 1) rowClass = "rank-1";
            if (rank === 2) rowClass = "rank-2";
            if (rank === 3) rowClass = "rank-3";

            // Render row
            leaderboardBody.innerHTML += `
            <tr class="${rowClass}">
                <td>${rank}</td>
                <td>${data.email || ""}</td>
                <td>${data.studentClass || ""}</td>
                <td>${data.subject || ""}</td>
                <td>${data.score}/${data.total}</td>
                <td>${data.accuracy}%</td>
                <td>${data.date ? data.date.toDate().toLocaleDateString() : ""}</td>
            </tr>
            `;

            rank++;
        });

        if (rank === 1) {
            // No documents found
            leaderboardBody.innerHTML = `
            <tr>
                <td colspan="7">No leaderboard data available</td>
            </tr>`;
        }
    } catch (error) {
        console.error("Error loading leaderboard:", error);
        leaderboardBody.innerHTML = `
        <tr>
            <td colspan="7">Error loading leaderboard data</td>
        </tr>`;
    }
}
