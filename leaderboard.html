<!DOCTYPE html>
<html>
<head>
    <title>Leaderboard - Olympiad Portal</title>
    <link rel="stylesheet" href="style.css">
    <style>
        table { width: 100%; border-collapse: collapse; background: var(--bg-card); border-radius: 12px; overflow: hidden; margin-top: 30px; }
        th { background: #334155; color: var(--primary); padding: 15px; text-align: left; }
        td { padding: 15px; border-bottom: 1px solid var(--border); }
        .rank-1 { background: rgba(245, 158, 11, 0.1); }
    </style>
</head>
<body>
<nav class="top-nav">
    <div class="nav-logo">üèÜ Leaderboard</div>
    <div class="nav-links">
        <a href="dashboard.html">Dashboard</a>
        <a href="quiz.html">Take Quiz</a>
        <a href="#" onclick="logout()">Logout</a>
    </div>
</nav>

<div style="max-width: 1100px; margin: 50px auto; padding: 0 20px;">
    <h1 style="text-align: center;">Top Performers</h1>
    <table>
        <thead>
            <tr><th>Rank</th><th>Student</th><th>Class</th><th>Subject</th><th>Score</th><th>Accuracy</th><th>Date</th></tr>
        </thead>
        <tbody id="leaderboardBody"></tbody>
    </table>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, collection, query, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB49W61ggHHJcAJ5WyYTmX13I8NofsggSY",
      authDomain: "olympiad-portal-d2a5e.firebaseapp.com",
      projectId: "olympiad-portal-d2a5e",
      storageBucket: "olympiad-portal-d2a5e.firebasestorage.app",
      messagingSenderId: "341855557503",
      appId: "1:341855557503:web:5cb0c3a9ee424a6db0ec4a"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    onAuthStateChanged(auth, user => { if (user) loadLeaderboard(); else window.location.href = "login.html"; });

    async function loadLeaderboard() {
        const body = document.getElementById("leaderboardBody");
        try {
            const q = query(collection(db, "leaderboard"), orderBy("score", "desc"));
            const snapshot = await getDocs(q);
            let rank = 1;
            snapshot.forEach(doc => {
                const data = doc.data();
                body.innerHTML += `<tr class="${rank <= 1 ? 'rank-1' : ''}">
                    <td>${rank++}</td><td>${data.email}</td><td>${data.studentClass}</td>
                    <td>${data.subject}</td><td>${data.score}/${data.total}</td>
                    <td>${data.accuracy}%</td><td>${data.date ? data.date.toDate().toLocaleDateString() : "-"}</td>
                </tr>`;
            });
        } catch (e) { console.error(e); }
    }

    window.logout = () => signOut(auth).then(() => window.location.href = "login.html");
</script>
</body>
</html>
