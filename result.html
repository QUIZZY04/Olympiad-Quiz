<!DOCTYPE html>
<html>
<head>
    <title>Results - Olympiad Portal</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .report-card { background: var(--bg-card); padding: 40px; border-radius: 16px; border: 1px solid var(--border); text-align: center; margin-bottom: 30px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; background: var(--bg-card); border-radius: 12px; }
        th { background: #334155; padding: 15px; text-align: left; }
        td { padding: 15px; border-bottom: 1px solid var(--border); }
        .correct-row { background: rgba(34, 197, 94, 0.1); }
        .wrong-row { background: rgba(239, 68, 68, 0.1); }
    </style>
</head>
<body>
<nav class="top-nav">
    <div class="nav-logo">üèÅ Quiz Result</div>
    <div class="nav-links"><a href="dashboard.html">Dashboard</a><a href="leaderboard.html">Leaderboard</a></div>
</nav>

<div style="max-width: 1100px; margin: 50px auto; padding: 0 20px;">
    <div class="report-card" id="summary"></div>
    <div style="text-align: center; margin-bottom: 40px;"><button class="btn-gold" onclick="location.href='quiz.html'">Retake Quiz</button></div>
    <div id="details"></div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB49W61ggHHJcAJ5WyYTmX13I8NofsggSY",
      authDomain: "olympiad-portal-d2a5e.firebaseapp.com",
      projectId: "olympiad-portal-d2a5e",
      storageBucket: "olympiad-portal-d2a5e.firebasestorage.app",
      messagingSenderId: "341855557503",
      appId: "1:341855557503:web:5cb0c3a9ee424a6db0ec4a"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    document.addEventListener("DOMContentLoaded", () => {
        const data = JSON.parse(localStorage.getItem("quizResult"));
        if (!data) return;
        const accuracy = (data.score / data.total * 100).toFixed(2);
        document.getElementById("summary").innerHTML = `<h1 style="color:var(--primary)">Score: ${data.score} / ${data.total}</h1><h3>Accuracy: ${accuracy}%</h3>`;

        let html = `<table><thead><tr><th>#</th><th>Question</th><th>Result</th><th>Solution</th></tr></thead><tbody>`;
        data.questions.forEach((q, i) => {
            const isCorrect = data.answers[i] == q.a;
            html += `<tr class="${isCorrect ? 'correct-row' : 'wrong-row'}">
                <td>${i + 1}</td><td>${q.q}</td>
                <td>${isCorrect ? '‚úÖ' : '‚ùå'}</td><td>${isCorrect ? '-' : q.sol}</td>
            </tr>`;
        });
        document.getElementById("details").innerHTML = html + "</tbody></table>";

        onAuthStateChanged(auth, async user => {
            if (user && !sessionStorage.getItem("resultSaved")) {
                await addDoc(collection(db, "leaderboard"), { email: user.email, uid: user.uid, studentClass: data.class, subject: data.subject, score: data.score, total: data.total, accuracy, date: new Date() });
                sessionStorage.setItem("resultSaved", "true");
            }
        });
    });
</script>
</body>
</html>
