<!DOCTYPE html>
<html>
<head>
<title>Olympiad Performance Report</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

<style>
/* --- SAME DESIGN (UNCHANGED) --- */
*{margin:0;padding:0;box-sizing:border-box;font-family:Segoe UI,sans-serif;}
body{background:#0f0f1b;color:white;}
nav{display:flex;justify-content:space-between;align-items:center;padding:20px 40px;background:#1e1e2f;}
nav h2{color:#ffb703;}
nav a{color:white;text-decoration:none;margin-left:20px;font-weight:500;}
nav a:hover{color:#ffb703;}
.container{max-width:1200px;margin:40px auto;padding:20px;}
.summary-card{background:#1e1e2f;padding:20px;border-radius:12px;text-align:center;margin-bottom:30px;}
table{width:100%;border-collapse:collapse;margin-top:20px;font-size:14px;}
th,td{padding:10px;border:1px solid #333;vertical-align:top;}
th{background:#2f2f55;}
.correct-row{background:#1e3a2f;}
.wrong-row{background:#3a1f1f;}
.action-btn{padding:10px 15px;border:none;border-radius:6px;margin:10px 5px;cursor:pointer;font-weight:bold;}
.quiz-btn{background:#ffb703;}
.logout-btn{background:#dc3545;color:white;}
</style>
</head>

<body>

<nav>
<h2>üéì Olympiad Portal</h2>
<div>
<a href="index.html">Home</a>
<a href="dashboard.html">Dashboard</a>
<a href="quiz.html">Take Quiz</a>
<a href="#" onclick="logout()">Logout</a>
</div>
</nav>

<div class="container">

<h1 style="text-align:center;margin-bottom:30px;">üèÜ Performance Report</h1>

<div class="summary-card" id="summary"></div>

<div style="text-align:center;">
<button class="action-btn quiz-btn" onclick="location.href='quiz.html'">
Take Another Quiz
</button>
</div>

<div id="details"></div>

</div>

<!-- ===== RESULT DISPLAY (UNCHANGED) ===== -->
<script>
document.addEventListener("DOMContentLoaded", function(){

const data = localStorage.getItem("quizResult");

if(!data){
document.getElementById("summary").innerHTML="<h2>No quiz data found.</h2>";
return;
}

const resultData = JSON.parse(data);
const score = resultData.score;
const total = resultData.total;
const accuracy = ((score/total)*100).toFixed(2);

document.getElementById("summary").innerHTML=
`<h2>Score: ${score} / ${total}</h2>
<h3>Accuracy: ${accuracy}%</h3>`;

let html=`<h2 style="margin-top:30px;">Detailed Analysis</h2>
<table>
<thead>
<tr>
<th>Q.No</th>
<th>Question</th>
<th>Your Answer</th>
<th>Correct Answer</th>
<th>Status</th>
<th>Hint</th>
<th>Solution</th>
</tr>
</thead><tbody>`;

resultData.questions.forEach((q,i)=>{
const userAns=resultData.answers[i];
const isCorrect=userAns==q.a;

html+=`
<tr class="${isCorrect?"correct-row":"wrong-row"}">
<td>${i+1}</td>
<td>${q.q}</td>
<td>${userAns!==null?q.o[userAns]:"Not Attempted"}</td>
<td>${q.o[q.a]}</td>
<td>${isCorrect?"‚úÖ Correct":"‚ùå Wrong"}</td>
<td>${!isCorrect?(q.hint||"-"):"-"}</td>
<td>${!isCorrect?(q.sol||"-"):"-"}</td>
</tr>`;
});

html+="</tbody></table>";
document.getElementById("details").innerHTML=html;

});
</script>

<!-- ===== FIREBASE ===== -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
apiKey: "AIzaSyB49W61ggHHJcAJ5WyYTmX13I8NofsggSY",
authDomain: "olympiad-portal-d2a5e.firebaseapp.com",
projectId: "olympiad-portal-d2a5e",
storageBucket: "olympiad-portal-d2a5e.firebasestorage.app",
messagingSenderId: "341855557503",
appId: "1:341855557503:web:5cb0c3a9ee424a6db0ec4a"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

onAuthStateChanged(auth, async(user)=>{
if(!user){
window.location.replace("login.html");
return;
}

const resultData=JSON.parse(localStorage.getItem("quizResult"));
if(!resultData) return;

if(sessionStorage.getItem("savedToFirebase")) return;

const score=resultData.score;
const total=resultData.total;
const accuracy=((score/total)*100).toFixed(2);

try{

// Save inside user
await addDoc(collection(db,"users",user.uid,"results"),{
subject:resultData.subject,
class:resultData.class,
score,total,accuracy,
date:new Date()
});

// Save inside leaderboard
await addDoc(collection(db,"leaderboard"),{
name:user.email,
class:resultData.class,
subject:resultData.subject,
score,total,accuracy,
date:new Date()
});

sessionStorage.setItem("savedToFirebase","true");

}catch(error){
console.error("Firebase Error:",error);
}

});

window.logout=function(){
signOut(auth).then(()=>{
localStorage.clear();
sessionStorage.clear();
window.location.replace("login.html");
});
};
</script>

</body>
</html>
