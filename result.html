<!DOCTYPE html>
<html>
<head>
<title>Olympiad Performance Report</title>
<script src="questions.js"></script>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>

<style>
body{
    margin:0;
    padding:40px;
    background:#0f0f1b;
    font-family:Arial, sans-serif;
    color:white;
}
.container{
    max-width:1100px;
    margin:auto;
}
h1{
    text-align:center;
    margin-bottom:30px;
}
.summary{
    background:#1e1e2f;
    padding:25px;
    border-radius:15px;
    margin-bottom:40px;
}
.grid{
    display:grid;
    grid-template-columns:repeat(4,1fr);
    gap:20px;
    margin-top:20px;
}
.card{
    background:#2f2f55;
    padding:15px;
    border-radius:10px;
    text-align:center;
}
.analysis-box{
    background:#1e1e2f;
    padding:20px;
    border-radius:12px;
    margin-bottom:20px;
}
.correct{ border-left:5px solid #4caf50; }
.wrong{ border-left:5px solid #ff4d4d; }
.hint{
    background:#3a3a6a;
    padding:10px;
    margin-top:10px;
    border-radius:8px;
}
.solution{
    background:#2f2f55;
    padding:12px;
    margin-top:10px;
    border-radius:8px;
    border-left:4px solid #6c63ff;
}
</style>
</head>

<body>

<div class="container">
<h1>üèÜ Olympiad Performance Report</h1>

<div class="summary">
<h2>Exam Summary</h2>
<div class="grid">
<div class="card" id="total"></div>
<div class="card" id="score"></div>
<div class="card" id="accuracy"></div>
<div class="card" id="grade"></div>
</div>
</div>

<h2>üìò Detailed Question Analysis</h2>
<div id="analysisContainer"></div>

</div>

<script>
// üî• Firebase Config
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_AUTH_DOMAIN",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_STORAGE_BUCKET",
  messagingSenderId: "YOUR_MSG_ID",
  appId: "YOUR_APP_ID"
};

if (!firebase.apps.length) {
  firebase.initializeApp(firebaseConfig);
}

const auth = firebase.auth();
const db = firebase.firestore();

document.addEventListener("DOMContentLoaded", function(){

const resultData = JSON.parse(localStorage.getItem("quizResult"));

if(!resultData){
    document.getElementById("analysisContainer").innerHTML =
        "<h3 style='color:red'>No quiz data found. Please attempt quiz again.</h3>";
    return;
}

const { score, total, answers, questions } = resultData;

let accuracy = total ? ((score/total)*100).toFixed(2) : 0;

let grade;
if(accuracy >= 90) grade="Outstanding";
else if(accuracy >= 75) grade="Excellent";
else if(accuracy >= 60) grade="Very Good";
else if(accuracy >= 40) grade="Good";
else grade="Needs Improvement";

document.getElementById("total").innerHTML = `<strong>Total Questions</strong><br>${total}`;
document.getElementById("score").innerHTML = `<strong>Score</strong><br>${score}`;
document.getElementById("accuracy").innerHTML = `<strong>Accuracy</strong><br>${accuracy}%`;
document.getElementById("grade").innerHTML = `<strong>Performance</strong><br>${grade}`;

// üî• SAVE RESULT TO FIREBASE
auth.onAuthStateChanged(function(user){
    if(user){
        db.collection("results").add({
            email: user.email,
            score: score,
            total: total,
            accuracy: accuracy,
            date: new Date()
        });
    }
});

let analysisHTML="";

questions.forEach((q,i)=>{

    const userAns = answers[i];
    const isCorrect = userAns == q.a;

    analysisHTML += `
    <div class="analysis-box ${isCorrect ? "correct" : "wrong"}">
        <h4>Q${i+1}. ${q.q}</h4>
        <p><strong>Your Answer:</strong> ${userAns !== null && userAns !== undefined ? q.o[userAns] : "Not Attempted"}</p>
        <p><strong>Correct Answer:</strong> ${q.o[q.a]}</p>
    `;

    if(!isCorrect){
        analysisHTML += `
            <div class="hint">
                <strong>Hint:</strong><br>${q.hint || "Review the related concept carefully."}
            </div>
            <div class="solution">
                <strong>Solution:</strong><br>${q.sol || "Refer to textbook explanation for detailed solution."}
            </div>
        `;
    }

    analysisHTML += `</div>`;
});

document.getElementById("analysisContainer").innerHTML = analysisHTML;

});
</script>

</body>
</html>