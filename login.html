<!DOCTYPE html>
<html>
<head>
<title>Login - Olympiad Portal</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
/* ... Your existing CSS ... */
:root {
    --amber: #ffb703;
    --danger: #dc3545;
    --muted: #94a3b8;
}

*{margin:0;padding:0;box-sizing:border-box;font-family:Segoe UI, sans-serif;}
body{background:linear-gradient(to right,#0f2027,#203a43,#2c5364);min-height:100vh;color:white;}

nav{display:flex;justify-content:space-between;align-items:center;padding:20px 40px;background:#1e2a38;}
nav h2{color:var(--amber);}
nav a{color:white;text-decoration:none;margin-left:20px;}
nav a:hover{color:var(--amber);}

.container{display:flex;justify-content:center;align-items:center;padding:40px 0;}
.login-box{background:#1e2a38;padding:40px;border-radius:15px;width:380px;text-align:center;box-shadow: 0 10px 25px rgba(0,0,0,0.3);}

input{width:100%;padding:12px;margin:10px 0;border:none;border-radius:8px;outline:none;}
button{width:100%;padding:12px;background:var(--amber);border:none;border-radius:8px;font-weight:bold;cursor:pointer;margin-top:10px;}
button:hover{background:#f59e0b;}

/* NEW STYLES */
.link-btn{background:none;color:var(--muted);font-size:13px;padding:0;margin:5px 0;width:auto;font-weight:normal;display:inline-block;}
.link-btn:hover{text-decoration:underline;color:var(--amber);}
.hidden{display:none;}
.status-msg{font-size:12px;margin-top:10px;padding:8px;border-radius:5px;}
.success{background:rgba(34,197,94,0.1);color:#22c55e;}
</style>
</head>

<body>

<nav>
    <h2>ðŸŽ“ Olympiad Portal</h2>
    <div>
        <a href="index.html">Home</a>
        <a href="signup.html">Signup</a>
    </div>
</nav>

<div class="container">
    <div class="login-box">
        <div id="loginSection">
            <h2 style="margin-bottom:20px;">Login</h2>
            <form id="loginForm">
                <input type="email" id="loginEmail" placeholder="Email" required>
                <input type="password" id="loginPassword" placeholder="Password" required>
                <button type="submit">Login</button>
            </form>
            <div style="margin-top:10px;">
                <button class="link-btn" onclick="toggleView('forgotSection')">Forgot Password?</button> | 
                <button class="link-btn" onclick="toggleView('changeSection')">Change Password</button>
            </div>
        </div>

        <div id="forgotSection" class="hidden">
            <h2 style="margin-bottom:10px;">Reset Password</h2>
            <p style="font-size:13px; color:var(--muted); margin-bottom:15px;">Enter your email to receive a reset link.</p>
            <form id="forgotForm">
                <input type="email" id="resetEmail" placeholder="Your Email" required>
                <button type="submit">Send Reset Link</button>
            </form>
            <button class="link-btn" onclick="toggleView('loginSection')" style="margin-top:15px;">Back to Login</button>
        </div>

        <div id="changeSection" class="hidden">
            <h2 style="margin-bottom:10px;">Change Password</h2>
            <p style="font-size:12px; color:var(--muted); margin-bottom:15px;">You must be logged in to use this feature.</p>
            <form id="changeForm">
                <input type="password" id="currentPassword" placeholder="Current Password" required>
                <input type="password" id="newPassword" placeholder="New Password" required>
                <button type="submit">Update Password</button>
            </form>
            <button class="link-btn" onclick="toggleView('loginSection')" style="margin-top:15px;">Back to Login</button>
        </div>

        <div id="msgBox" class="status-msg hidden"></div>

        <p style="margin-top:20px; border-top:1px solid #334155; padding-top:20px;">
            Don't have an account? <a href="signup.html" style="color:var(--amber); text-decoration:none; font-weight:bold;">Signup</a>
        </p>
    </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, sendPasswordResetEmail, updatePassword, reauthenticateWithCredential, EmailAuthProvider } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyB49W61ggHHJcAJ5WyYTmX13I8NofsggSY",
  authDomain: "olympiad-portal-d2a5e.firebaseapp.com",
  projectId: "olympiad-portal-d2a5e",
  storageBucket: "olympiad-portal-d2a5e.firebasestorage.app",
  messagingSenderId: "341855557503",
  appId: "1:341855557503:web:5cb0c3a9ee424a6db0ec4a"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

// View Toggler
window.toggleView = (sectionId) => {
    ['loginSection', 'forgotSection', 'changeSection'].forEach(id => {
        document.getElementById(id).classList.add('hidden');
    });
    document.getElementById(sectionId).classList.remove('hidden');
    document.getElementById('msgBox').classList.add('hidden');
};

// 1. Handling Login
document.getElementById("loginForm").addEventListener("submit", async (e)=>{
    e.preventDefault();
    try{
        await signInWithEmailAndPassword(auth, document.getElementById("loginEmail").value, document.getElementById("loginPassword").value);
        window.location.href="dashboard.html";
    } catch(err) { alert(err.message); }
});

// 2. Handling Forgot Password
document.getElementById("forgotForm").addEventListener("submit", async (e)=>{
    e.preventDefault();
    const email = document.getElementById("resetEmail").value;
    try {
        await sendPasswordResetEmail(auth, email);
        showMsg("Reset link sent! Please check your email.", "success");
    } catch(err) { alert(err.message); }
});

// 3. Handling Change Password
document.getElementById("changeForm").addEventListener("submit", async (e)=>{
    e.preventDefault();
    const user = auth.currentUser;
    if(!user) { alert("Please login first to change your password."); return; }

    const curPwd = document.getElementById("currentPassword").value;
    const newPwd = document.getElementById("newPassword").value;
    const credential = EmailAuthProvider.credential(user.email, curPwd);

    try {
        // Re-authenticate user before sensitive operation
        await reauthenticateWithCredential(user, credential);
        await updatePassword(user, newPwd);
        showMsg("Password updated successfully!", "success");
        document.getElementById("changeForm").reset();
    } catch(err) { alert(err.message); }
});

function showMsg(text, type) {
    const box = document.getElementById('msgBox');
    box.innerText = text;
    box.className = `status-msg ${type}`;
    box.classList.remove('hidden');
}
</script>
</body>
</html>
