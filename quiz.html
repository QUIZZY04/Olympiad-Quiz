<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Quiz</title>
<link rel="stylesheet" href="style.css">

<style>

/* ===== TOP BAR ===== */
.top-bar{
    background:#111;
    padding:15px 30px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    font-size:18px;
    border-bottom:1px solid rgba(255,255,255,0.1);
}

#timer{
    color:#ffb703;
    font-weight:bold;
}

/* ===== LAYOUT ===== */
.quiz-container{
    display:flex;
    height:calc(100vh - 60px);
}

.question-section{
    flex:3;
    padding:40px;
    overflow-y:auto;
}

.navigation-section{
    flex:1;
    background:rgba(255,255,255,0.05);
    padding:25px;
    border-left:1px solid rgba(255,255,255,0.1);
    overflow-y:auto;
}

/* ===== PROGRESS BAR ===== */
.progress-wrapper{
    margin-bottom:20px;
}

.progress-info{
    font-size:14px;
    margin-bottom:6px;
}

.progress-bar{
    width:100%;
    height:12px;
    background:#333;
    border-radius:10px;
    overflow:hidden;
}

.progress-fill{
    height:100%;
    width:0%;
    background:#28a745;
    transition:width 0.3s ease;
}

/* QUESTION */
#questionText{
    font-size:20px;
    margin:20px 0;
}

/* OPTIONS */
.options label{
    display:block;
    padding:12px;
    margin:10px 0;
    font-size:18px;
    background:rgba(255,255,255,0.08);
    border-radius:8px;
    cursor:pointer;
    transition:0.2s;
}

.options label:hover{
    background:rgba(255,183,3,0.15);
}

/* BUTTONS */
.quiz-buttons{
    margin-top:25px;
}

.quiz-buttons button{
    width:130px;
    margin-right:10px;
}

/* GRID */
.grid{
    display:grid;
    grid-template-columns:repeat(5,1fr);
    gap:10px;
    margin-top:20px;
}

.grid div{
    padding:10px;
    text-align:center;
    border-radius:6px;
    cursor:pointer;
    font-size:14px;
    transition:0.2s;
}

/* LEGEND */
.legend{
    margin-top:25px;
    font-size:14px;
}

.legend div{
    margin:5px 0;
}

/* RESPONSIVE */
@media(max-width:900px){
    .quiz-container{
        flex-direction:column;
    }
    .navigation-section{
        border-left:none;
        border-top:1px solid rgba(255,255,255,0.1);
    }
}

</style>
</head>
<body>

<div class="top-bar">
    <div id="subjectTitle"></div>
    <div>Time Left: <span id="timer">30:00</span></div>
</div>

<div class="quiz-container">

    <!-- LEFT SIDE -->
    <div class="question-section">

        <!-- PROGRESS BAR -->
        <div class="progress-wrapper">
            <div class="progress-info">
                Answered: <span id="answeredCount">0</span> / 30
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <h3 id="questionNumber"></h3>
        <p id="questionText"></p>

        <div class="options" id="options"></div>

        <div class="quiz-buttons">
            <button onclick="prevQuestion()">Previous</button>
            <button onclick="nextQuestion()">Next</button>
            <button onclick="confirmSubmit()">Submit</button>
        </div>

    </div>

    <!-- RIGHT SIDE -->
    <div class="navigation-section">

        <h3>Question Palette</h3>
        <div class="grid" id="questionGrid"></div>

        <div class="legend">
            <h4>Status Legend</h4>
            <div>ðŸŸ¡ Current</div>
            <div>ðŸŸ¢ Answered</div>
            <div>ðŸ”´ Visited</div>
            <div>âšª Not Visited</div>
        </div>

    </div>

</div>

<script src="questions.js"></script>

<script>

/* ================= QUIZ STATE ================= */

let current = 0;
let score = 0;
let selectedAnswers = new Array(30).fill(null);
let visitedQuestions = new Array(30).fill(false);

const selectedClass = localStorage.getItem("class") || "class4";
const selectedSubject = localStorage.getItem("subject") || "maths";

document.getElementById("subjectTitle").innerText =
selectedClass.toUpperCase() + " - " + selectedSubject.toUpperCase();

const questions = questionsData[selectedClass][selectedSubject];

/* ================= TIMER ================= */

let totalTime = 1800;

const timerInterval = setInterval(function(){

    let minutes = Math.floor(totalTime/60);
    let seconds = totalTime % 60;

    document.getElementById("timer").innerText =
    minutes + ":" + (seconds<10?"0":"") + seconds;

    totalTime--;

    if(totalTime < 0){
        clearInterval(timerInterval);
        submitQuiz();
        alert("Time is up! Quiz submitted automatically.");
    }

},1000);

/* ================= LOAD QUESTION ================= */

function loadQuestion(){

    visitedQuestions[current] = true;

    const q = questions[current];

    document.getElementById("questionNumber").innerText =
    "Question " + (current+1) + " of 30";

    document.getElementById("questionText").innerText = q.q;

    let optionsHTML = "";

    q.o.forEach((opt,i)=>{
        optionsHTML += `
        <label>
        <input type="radio" name="option" value="${i}"
        ${selectedAnswers[current]===i ? "checked":""}>
        ${opt}
        </label>`;
    });

    document.getElementById("options").innerHTML = optionsHTML;

    updateGrid();
}

/* ================= NAVIGATION ================= */

function nextQuestion(){
    saveAnswer();
    if(current < 29){
        current++;
        loadQuestion();
    }
}

function prevQuestion(){
    saveAnswer();
    if(current > 0){
        current--;
        loadQuestion();
    }
}

function jumpTo(index){
    saveAnswer();
    current = index;
    loadQuestion();
}

/* ================= SAVE ANSWER ================= */

function saveAnswer(){
    const selected =
    document.querySelector('input[name="option"]:checked');

    if(selected){
        selectedAnswers[current] =
        parseInt(selected.value);
    }

    updateProgress();
}

/* ================= PROGRESS ================= */

function updateProgress(){

    let answered = selectedAnswers.filter(a => a !== null).length;

    document.getElementById("answeredCount").innerText = answered;

    let percentage = (answered / 30) * 100;

    document.getElementById("progressFill").style.width =
    percentage + "%";
}

/* ================= SUBMIT ================= */

function confirmSubmit(){

    let answered = selectedAnswers.filter(a => a !== null).length;

    let confirmBox = confirm(
        "You have answered " + answered + " out of 30 questions.\n\nAre you sure you want to submit?"
    );

    if(confirmBox){
        submitQuiz();
    }
}

function submitQuiz(){

    saveAnswer();

    score = 0;

    for(let i=0;i<30;i++){
        if(selectedAnswers[i] === questions[i].a){
            score++;
        }
    }

    localStorage.setItem("score",score);
    localStorage.setItem("total",30);

    window.location = "result.html";
}

/* ================= GRID ================= */

function generateGrid(){

    let gridHTML = "";

    for(let i=0;i<30;i++){
        gridHTML += `
        <div onclick="jumpTo(${i})"
        id="q${i}">${i+1}</div>`;
    }

    document.getElementById("questionGrid").innerHTML = gridHTML;
}

function updateGrid(){

    for(let i=0;i<30;i++){

        let cell = document.getElementById("q"+i);

        if(i === current){
            cell.style.background = "#ffb703";
            cell.style.color = "black";
        }
        else if(selectedAnswers[i] !== null){
            cell.style.background = "#28a745";
            cell.style.color = "white";
        }
        else if(visitedQuestions[i]){
            cell.style.background = "#dc3545";
            cell.style.color = "white";
        }
        else{
            cell.style.background = "#555";
            cell.style.color = "white";
        }
    }
}

/* INITIAL LOAD */

generateGrid();
loadQuestion();
updateProgress();

</script>

</body>
</html>