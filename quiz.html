<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Quiz</title>

<link rel="stylesheet" href="style.css">

<meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

<style>
body{
    margin:0;
    font-family:Segoe UI, sans-serif;
    background:#0f0f1b;
    color:white;
}
nav{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:15px 40px;
    background:#1e1e2f;
}
.nav-left{
    display:flex;
    align-items:center;
    gap:10px;
}
.nav-left img{
    width:35px;
}
.nav-left h2{
    color:#ffb703;
    margin:0;
}
nav a{
    color:white;
    text-decoration:none;
    margin-left:25px;
    cursor:pointer;
}
nav a:hover{ color:#ffb703; }

.top-bar{
    background:#141424;
    padding:15px 40px;
    display:flex;
    justify-content:space-between;
}
#timer{ color:#ffb703; font-weight:bold; }

.quiz-container{
    display:flex;
    height:calc(100vh - 120px);
}
.question-section{
    flex:3;
    padding:40px;
    overflow-y:auto;
}
.navigation-section{
    flex:1;
    background:#1a1a2e;
    padding:25px;
}

.progress-bar{
    width:100%;
    height:10px;
    background:#333;
    border-radius:10px;
    overflow:hidden;
}
.progress-fill{
    height:100%;
    width:0%;
    background:#28a745;
}

.options label{
    display:block;
    padding:14px;
    margin:12px 0;
    background:#1f1f35;
    border-radius:8px;
    cursor:pointer;
}
.options label:hover{ background:#29294d; }

.quiz-buttons button{
    background:#ffb703;
    padding:10px 15px;
    border:none;
    margin-right:10px;
    border-radius:6px;
    font-weight:bold;
    cursor:pointer;
}

.grid{
    display:grid;
    grid-template-columns:repeat(5,1fr);
    gap:10px;
}
.grid div{
    padding:10px;
    background:#333;
    text-align:center;
    border-radius:6px;
    cursor:pointer;
}
</style>
</head>

<body>

<nav>
<div class="nav-left">
<img src="logo.png">
<h2>Olympiad Portal</h2>
</div>
<div>
<a onclick="confirmLeave('index.html')">Home</a>
<a onclick="confirmLeave('dashboard.html')">Dashboard</a>
<a onclick="confirmLeave('leaderboard.html')">Leaderboard</a>
<a onclick="logout()">Logout</a>
</div>
</nav>

<div class="top-bar">
<div id="subjectTitle"></div>
<div>Time Left: <span id="timer">30:00</span></div>
</div>

<div class="quiz-container">

<div class="question-section">
<div>
Answered: <span id="answeredCount">0</span> /
<span id="totalCount"></span>
<div class="progress-bar">
<div class="progress-fill" id="progressFill"></div>
</div>
</div>

<h3 id="questionNumber"></h3>
<p id="questionText"></p>
<div class="options" id="options"></div>

<div class="quiz-buttons">
<button onclick="prevQuestion()">Previous</button>
<button onclick="nextQuestion()">Next</button>
<button onclick="confirmSubmit()">Submit</button>
</div>
</div>

<div class="navigation-section">
<h3>Question Palette</h3>
<div class="grid" id="questionGrid"></div>
</div>

</div>

<script src="questions.js"></script>

<script>
let current = 0;
let score = 0;

const selectedClass = localStorage.getItem("selectedClass") || "class4";
const selectedSubject = localStorage.getItem("selectedSubject") || "maths";

document.getElementById("subjectTitle").innerText =
selectedClass.toUpperCase() + " - " + selectedSubject.toUpperCase();

const questions = questionsData[selectedClass][selectedSubject];

document.getElementById("totalCount").innerText = questions.length;

let selectedAnswers = new Array(questions.length).fill(null);
let visitedQuestions = new Array(questions.length).fill(false);

/* TIMER */
let totalTime = 1800;
setInterval(function(){
let minutes = Math.floor(totalTime/60);
let seconds = totalTime % 60;
document.getElementById("timer").innerText =
minutes + ":" + (seconds<10?"0":"") + seconds;
totalTime--;
if(totalTime < 0) submitQuiz();
},1000);

/* LOAD QUESTION */
function loadQuestion(){
visitedQuestions[current] = true;
const q = questions[current];
document.getElementById("questionNumber").innerText =
"Question " + (current+1) + " of " + questions.length;
document.getElementById("questionText").innerHTML = q.q;

let html="";
q.o.forEach((opt,i)=>{
html+=`<label>
<input type="radio" name="option" value="${i}"
${selectedAnswers[current]===i?"checked":""}
onchange="saveAnswer(${i})"> ${opt}
</label>`;
});
document.getElementById("options").innerHTML=html;
updateGrid();
updateProgress();
}

function saveAnswer(v){ selectedAnswers[current]=v; }

function nextQuestion(){
if(current<questions.length-1){ current++; loadQuestion(); }
}
function prevQuestion(){
if(current>0){ current--; loadQuestion(); }
}

function confirmSubmit(){
if(confirm("Submit Quiz?")) submitQuiz();
}

function submitQuiz(){
score=0;
for(let i=0;i<questions.length;i++){
if(selectedAnswers[i]===questions[i].a) score++;
}
localStorage.setItem("quizResult",
JSON.stringify({score,total:questions.length,
subject:selectedSubject,class:selectedClass,
answers:selectedAnswers,questions:questions}));
window.location.href="result.html";
}

function generateGrid(){
let html="";
for(let i=0;i<questions.length;i++){
html+=`<div onclick="jumpTo(${i})" id="q${i}">${i+1}</div>`;
}
document.getElementById("questionGrid").innerHTML=html;
}

function jumpTo(i){ current=i; loadQuestion(); }

function updateProgress(){
let answered=selectedAnswers.filter(a=>a!==null).length;
document.getElementById("answeredCount").innerText=answered;
document.getElementById("progressFill").style.width=
(answered/questions.length*100)+"%";
}

function updateGrid(){
for(let i=0;i<questions.length;i++){
let cell=document.getElementById("q"+i);
if(i===current){ cell.style.background="#ffb703"; }
else if(selectedAnswers[i]!==null){ cell.style.background="#28a745"; }
else if(visitedQuestions[i]){ cell.style.background="#dc3545"; }
else{ cell.style.background="#333"; }
}
}

/* LEAVE WARNING */
function confirmLeave(url){
if(confirm("Quiz progress will be lost. Leave?")){
window.location.href=url;
}
}

function logout(){
localStorage.clear();
window.location.href="login.html";
}

generateGrid();
loadQuestion();
</script>

</body>
</html>
